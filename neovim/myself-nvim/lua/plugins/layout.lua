-- ============================================================================
-- 智能分屏管理插件配置
-- 使用 smart-splits.nvim 提供更智能、更直观的分屏窗口管理
-- 支持与 Tmux、Wezterm、Kitty 等终端复用器无缝集成
-- ============================================================================

-- ----------------------------------------------------------------------------
-- 调试开关
-- 如果第一行为 true，整个配置将被禁用（返回空表）
-- 删除或注释掉这行代码来激活此配置文件
-- ----------------------------------------------------------------------------
-- if true then return {} end -- 警告：删除此行以激活此文件

-- ----------------------------------------------------------------------------
-- 插件定义
-- smart-splits.nvim 提供智能的窗口调整和光标移动功能
-- ----------------------------------------------------------------------------
local Layout = {
    -- 插件仓库地址
    'mrjones2014/smart-splits.nvim',
    
    -- ------------------------------------------------------------------------
    -- 延迟加载配置
    -- 只在需要时才加载插件，优化启动性能
    -- ------------------------------------------------------------------------
    lazy = true,  -- 启用延迟加载
    
    -- 触发加载的命令列表
    -- 当执行这些命令时，插件才会被加载
    cmd = {
        'SmartResizeLeft',          -- 向左调整窗口大小
        'SmartResizeRight',         -- 向右调整窗口大小
        'SmartResizeUp',            -- 向上调整窗口大小
        'SmartResizeDown',          -- 向下调整窗口大小
        'SmartCursorMoveLeft',      -- 将光标移动到左侧窗口
        'SmartCursorMoveDown',      -- 将光标移动到下方窗口
        'SmartCursorMoveUp',        -- 将光标移动到上方窗口
        'SmartCursorMoveRight',     -- 将光标移动到右侧窗口
    },
    
    -- ------------------------------------------------------------------------
    -- 插件配置函数
    -- 在插件加载后执行，设置所有选项
    -- ------------------------------------------------------------------------
    config = function()
        require('smart-splits').setup {
            -- ----------------------------------------------------------------
            -- 忽略的缓冲区类型（仅在调整窗口大小时生效）
            -- 这些类型的缓冲区不会参与窗口大小调整
            -- ----------------------------------------------------------------
            ignored_buftypes = {
                'nofile',       -- 无文件缓冲区（如帮助文档）
                'quickfix',     -- 快速修复列表
                'prompt',       -- 提示缓冲区
            },
            
            -- ----------------------------------------------------------------
            -- 忽略的文件类型（仅在调整窗口大小时生效）
            -- 这些文件类型的窗口不会被调整大小
            -- ----------------------------------------------------------------
            -- ignored_filetypes = { 
            --     'NvimTree'  -- NvimTree 文件浏览器
            -- },
            
            -- ----------------------------------------------------------------
            -- 默认调整大小的数量
            -- 每次调整窗口大小时增加或减少的行数/列数
            -- ----------------------------------------------------------------
            default_amount = 3,
            
            -- ----------------------------------------------------------------
            -- 边缘行为设置
            -- 当光标位于边缘并继续朝该方向移动时的行为
            -- ----------------------------------------------------------------
            -- 可选值：
            -- 'wrap'   => 环绕到对面（例如从最右边跳到最左边）
            -- 'split'  => 在指定方向创建新的分屏
            -- 'stop'   => 什么都不做（停在边缘）
            -- function => 自定义处理函数
            --
            -- 如果使用函数，函数将接收一个包含以下字段的上下文对象：
            -- {
            --    mux = {  -- 终端复用器相关方法
            --      type: 'tmux'|'wezterm'|'kitty'|'zellij'  -- 复用器类型
            --      current_pane_id(): number,                -- 当前窗格 ID
            --      is_in_session(): boolean                  -- 是否在会话中
            --      current_pane_is_zoomed(): boolean,        -- 当前窗格是否最大化
            --      -- 以下方法返回布尔值表示成功或失败
            --      current_pane_at_edge(direction): boolean  -- 检查是否在边缘
            --      next_pane(direction): boolean             -- 切换到下一个窗格
            --      resize_pane(direction): boolean           -- 调整窗格大小
            --      split_pane(direction, size): boolean      -- 分割窗格
            --    },
            --    direction = 'left'|'right'|'up'|'down',    -- 移动方向
            --    split(),  -- 工具函数：在当前方向分割 Neovim 窗格
            --    wrap(),   -- 工具函数：环绕到对面的 Neovim 窗格
            -- }
            --
            -- 注意：Kitty 终端复用器不支持 at_edge = 'wrap'
            -- 因为无法通过 CLI 确定布局信息
            at_edge = 'wrap',
            
            -- ----------------------------------------------------------------
            -- 浮动窗口行为
            -- 当前窗口为浮动窗口时的处理方式
            -- ----------------------------------------------------------------
            -- 可选值：
            -- 'previous' => 聚焦到上一个 Vim 窗口并执行操作
            -- 'mux'      => 始终将操作转发给终端复用器
            float_win_behavior = 'previous',
            
            -- ----------------------------------------------------------------
            -- 光标行位置保持
            -- 在左右移动分屏时，是否将光标放在屏幕的相同行
            -- 而不考虑实际的行号
            -- ----------------------------------------------------------------
            -- false（默认）：光标保持在相同的逻辑行号
            -- true：光标保持在屏幕的相同视觉位置
            -- 可以通过函数参数覆盖此设置
            move_cursor_same_row = false,
            
            -- ----------------------------------------------------------------
            -- 缓冲区交换时光标跟随
            -- 交换缓冲区时光标是否跟随缓冲区移动
            -- ----------------------------------------------------------------
            -- 也可以通过调用 Lua 函数时传递
            -- `{ move_cursor = true }` 或 `{ move_cursor = false }` 来控制
            cursor_follows_swapped_bufs = false,
            
            -- ----------------------------------------------------------------
            -- 调整大小模式选项
            -- 持久化调整大小模式的配置
            -- ----------------------------------------------------------------
            resize_mode = {
                -- 退出持久化调整大小模式的按键
                quit_key = '<ESC>',
                
                -- 在调整大小模式中用于移动的按键
                -- 顺序：左、下、上、右
                resize_keys = { 'h', 'j', 'k', 'l' },
                
                -- 设置为 true 可在进入/退出持久化调整大小模式时
                -- 静默通知（不显示提示）
                silent = false,
                
                -- 钩子函数，必须是函数类型
                -- 在进入或退出调整大小模式时执行
                hooks = {
                    on_enter = nil,  -- 进入时执行的函数
                    on_leave = nil,  -- 离开时执行的函数
                },
            },
            
            -- ----------------------------------------------------------------
            -- 忽略的自动命令事件
            -- 在处理 smart-splits.nvim 计算时忽略这些事件
            -- ----------------------------------------------------------------
            -- 这些事件在处理过程中会被忽略（通过 :h eventignore）
            -- 处理涉及访问不同的缓冲区和窗口
            -- 完成后会恢复这些事件
            -- 仅适用于调整大小事件，不适用于光标移动事件
            ignored_events = {
                'BufEnter',  -- 进入缓冲区事件
                'WinEnter',  -- 进入窗口事件
            },
            
            -- ----------------------------------------------------------------
            -- 终端复用器集成
            -- 启用或禁用与终端复用器的集成
            -- ----------------------------------------------------------------
            -- 如果未明确禁用或设置，会自动检测：
            -- - 检查 $TERM_PROGRAM 环境变量
            -- - 对于 Kitty，检查 $KITTY_LISTEN_ON 环境变量
            --
            -- 也可以在插件加载前通过设置以下变量来控制：
            -- vim.g.smart_splits_multiplexer_integration
            -- （例如在 lazy 环境中）
            multiplexer_integration = nil,
            
            -- ----------------------------------------------------------------
            -- 复用器窗格最大化时禁用导航
            -- 当终端复用器窗格被放大（zoomed）时禁用导航
            -- ----------------------------------------------------------------
            -- 仅支持 tmux 和 Wezterm
            -- Kitty 不支持此功能，因为无法检查窗格是否被放大
            disable_multiplexer_nav_when_zoomed = true,
            
            -- ----------------------------------------------------------------
            -- Kitty 远程控制密码
            -- 如果需要，提供 Kitty 远程控制密码
            -- ----------------------------------------------------------------
            -- 也可以设置 vim.g.smart_splits_kitty_password
            -- 参考：https://sw.kovidgoyal.net/kitty/conf/#opt-kitty.remote_control_password
            kitty_password = nil,
            
            -- ----------------------------------------------------------------
            -- 日志级别
            -- 设置默认的日志记录级别
            -- ----------------------------------------------------------------
            -- 可选值：'trace'|'debug'|'info'|'warn'|'error'|'fatal'
            log_level = 'info',
        }
    end,
}

return Layout