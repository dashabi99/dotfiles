-- ============================================================================
-- 选项配置文件
-- 此文件包含在 Lazy.nvim 初始化后执行的 Vim 选项设置
-- 这些是编辑器的核心配置，控制编辑行为和显示效果
-- ============================================================================

local Options = {}

-- ----------------------------------------------------------------------------
-- Vim 选项配置表
-- 定义所有要设置的 vim.opt 选项
-- ----------------------------------------------------------------------------
Options.opt = {
    -- 行号显示设置
    relativenumber = false,     -- 禁用相对行号（显示绝对行号）
                                -- true 时显示相对于当前行的行号，便于快速跳转
    
    -- 拼写检查
    spell = false,              -- 禁用拼写检查
                                -- 启用后会对英文单词进行拼写检查
    
    -- 符号列（用于显示诊断信息、Git 标记等）
    signcolumn = 'auto',        -- 符号列自动显示
                                -- 'auto': 有内容时显示，无内容时隐藏
                                -- 'yes': 始终显示
                                -- 'no': 始终隐藏
    
    -- 文本换行
    wrap = true,               -- 禁用自动换行
                                -- false: 长行会超出屏幕，需要水平滚动
                                -- true: 长行会在窗口边缘自动换行显示
    
    -- 剪贴板集成
    clipboard = 'unnamedplus',  -- 使用系统剪贴板
                                -- 'unnamed': 使用 * 寄存器（X11 PRIMARY）
                                -- 'unnamedplus': 使用 + 寄存器（系统剪贴板）
                                -- 可以在 Vim 和其他应用间复制粘贴
    
    -- 终端真彩色支持
    termguicolors = true,       -- 启用 24 位真彩色（RGB 颜色）
                                -- 需要终端支持真彩色
    
    -- 命令行补全
    wildmenu = true,            -- 启用命令行补全增强菜单
                                -- 按 Tab 键时显示可能的补全选项
    completeopt = { "menu", "menuone", "noselect", "noinsert" },
                                -- 补全选项配置
                                -- "menu": 显示补全菜单
                                -- "menuone": 即使只有一个选项也显示菜单
                                -- "noselect": 不自动选择任何选项
                                -- "noinsert": 不自动插入选项内容

    -- 搜索设置
    ignorecase = true,          -- 搜索时忽略大小写
                                -- 配合 smartcase 使用效果更好
    smartcase = true,           -- 包含大写字母时精确匹配
    hlsearch = false,           -- 不高亮搜索结果
    incsearch = true,           -- 增量搜索
    
    -- 撤销持久化
    undofile = true,            -- 启用持久化撤销
                                -- 关闭文件后重新打开仍可撤销之前的修改
    undodir = vim.fn.stdpath('state') .. '/undo',
                                -- 设置撤销文件保存目录
                                -- stdpath('state') 通常是 ~/.local/state/nvim
    
    -- 滚动设置
    scrolloff = 5,              -- 光标上下保持的最小行数
                                -- 滚动时光标距离窗口边缘至少保留 5 行
    
    -- 虚拟编辑模式
    virtualedit = 'block',      -- 在块选择模式下允许光标超出行尾
                                -- 'block': 仅在可视块模式生效
                                -- 'all': 在所有模式生效
    inccommand = "split",       -- 实时预览替换效果
    confirm = true,             -- 退出前确认未保存的更改

    -- ========== 命令行和界面设置 ==========
    cmdheight = 1,              -- 命令行高度
    showmode = true,            -- 隐藏模式提示（使用statusline显示）
    showcmd = true,             -- 隐藏模式提示（使用statusline显示）
    showtabline = 2,            -- 始终显示标签行
    pumheight = 15,             -- 弹出菜单最大高度（增加到15，显示更多选项）

    -- ========== 文件处理设置 ==========
    autoread = true,            -- 自动读取外部修改
    hidden = true,              -- 允许隐藏未保存的缓冲区

    -- ========== 鼠标和输入设备 ==========
    -- mouse = "a",                -- 启用鼠标支持

    -- ========== 时间设置 ==========
    updatetime = 250,           -- 减少到250ms，提高响应速度
    timeoutlen = 300,           -- 减少按键超时时间

    -- ========== 窗口分割 ==========
    splitbelow = true,          -- 水平分割在下方
    splitright = true,          -- 垂直分割在右方

    -- ========== 不可见字符 ==========
    list = true, -- 启用不可见字符显示
    listchars = {
        -- space = "·", -- 注释掉以避免太多视觉干扰
        tab = "→ ", -- 制表符
        eol = "↲", -- 这会显示行尾的换行符
        trail = "␣", -- 行尾空格
        extends = "❯", -- 右侧截断标记
        precedes = "❮", -- 左侧截断标记
        },
}

-- ----------------------------------------------------------------------------
-- 应用选项配置
-- 执行所有选项设置，并进行额外的初始化工作
-- ----------------------------------------------------------------------------
function Options.apply()
    -- ------------------------------------------------------------------------
    -- 创建撤销文件目录
    -- ------------------------------------------------------------------------
    -- 如果撤销目录不存在，则创建它
    -- 'p' 参数表示创建必要的父目录（类似 mkdir -p）
    vim.fn.mkdir(vim.opt.undodir:get()[1], 'p')

    -- ------------------------------------------------------------------------
    -- 应用所有选项
    -- ------------------------------------------------------------------------
    -- 遍历 Options.opt 表，将每个选项应用到 vim.o
    for k, v in pairs(Options.opt) do
        vim.opt[k] = v  -- vim.o 是 vim.opt 的简化访问方式
    end

    -- ------------------------------------------------------------------------
    -- 文件类型识别配置
    -- ------------------------------------------------------------------------
    -- 添加自定义文件类型识别规则
    vim.filetype.add ({
        -- 根据文件扩展名识别
        extension = {
            mdx = 'markdown',  -- 将 .mdx 文件识别为 markdown 类型
                               -- MDX 是支持 JSX 的 Markdown 格式
        },
        
        -- 根据文件名模式识别
        pattern = {
            -- 添加模式匹配规则
            -- 示例：['.*%.env%..*'] = 'sh',  -- .env.* 文件识别为 shell
            -- 示例：['Dockerfile.*'] = 'dockerfile',
        },
    })
end

-- 返回 Options 模块
return Options